datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Airline {
  id            BigInt           @id @default(autoincrement())
  code          String        @unique @db.Char(2)
  name          String
  flights       Flight[]
  sharedFlights SharedFlight[] @relation("SharedAirline")
}

model Airport {
  id        BigInt      @id @default(autoincrement())
  code      String   @unique @db.Char(3)
  name      String
  city      String
  country   String

  departingFlights Flight[] @relation("DepartureAirport")
  arrivingFlights  Flight[] @relation("ArrivalAirport")
}

model AircraftType {
  id                BigInt      @id @default(autoincrement())
  modelName         String   @unique
  seatCapacity      Int
  seatingPlanJson   Json
  maxCrewCount      Int
  standardMenu      String
  flights           Flight[]
}

enum FlightStatus {
  scheduled
  ongoing
  delayed
  cancelled
  completed
}

model Flight {
  id                      BigInt          @id @default(autoincrement())
  flightNumber            String       @unique @db.Char(6)
  airlineId               BigInt
  airline                 Airline      @relation(fields: [airlineId], references: [id])
  departureTime           DateTime
  durationMinutes         Int
  distanceKm              Float
  sourceAirportCode       String
  sourceAirport           Airport      @relation("DepartureAirport", fields: [sourceAirportCode], references: [code])
  destinationAirportCode  String
  destinationAirport      Airport      @relation("ArrivalAirport", fields: [destinationAirportCode], references: [code])
  aircraftTypeId          BigInt
  aircraftType            AircraftType @relation(fields: [aircraftTypeId], references: [id])
  sharedFlight            SharedFlight?
  status                  FlightStatus @default(scheduled) 
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
}

model SharedFlight {
  id                  BigInt      @id @default(autoincrement())
  mainFlightId        BigInt      @unique
  mainFlight          Flight   @relation(fields: [mainFlightId], references: [id], onDelete: Cascade)
  partnerFlightNumber String   @db.Char(6)
  partnerAirlineId    BigInt
  partnerAirline      Airline  @relation("SharedAirline", fields: [partnerAirlineId], references: [id])
  connectingFlightInfo String?
}
